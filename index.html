<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文具申請系統</title>
    <style>
        /* --- 網頁視覺樣式 (螢幕顯示) --- */
        body { 
            font-family: "Microsoft JhengHei", sans-serif; 
            background-color: #f0f7ff; /* 淡淡的藍色背景 */
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh;
            margin: 0;
        }

        .card { 
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); 
            width: 100%; 
            max-width: 400px; 
        }

        h2 { color: #4a90e2; text-align: center; margin-bottom: 25px; }

        .form-group { margin-bottom: 15px; }
        
        label { display: block; margin-bottom: 8px; color: #666; font-weight: bold; }
        
        input, select { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #e1e8ed; 
            border-radius: 10px; 
            box-sizing: border-box; 
            font-size: 16px;
            outline: none;
            transition: border 0.3s;
        }

        input:focus { border-color: #4a90e2; }

        button { 
            width: 100%; 
            padding: 15px; 
            background-color: #4a90e2; 
            color: white; 
            border: none; 
            border-radius: 10px; 
            font-size: 18px; 
            font-weight: bold;
            cursor: pointer; 
            margin-top: 10px;
            transition: background 0.3s;
        }

        button:hover { background-color: #357abd; }

        /* --- 列印專用樣式 --- */
        #printArea { display: none; }

        @media print {
            body { background-color: white; }
            .card { display: none; } /* 列印時隱藏輸入表單 */
            
            #printArea { 
                display: block; 
                width: 100%;
                padding: 20px;
                color: black;
            }
            .print-header { 
                text-align: center; 
                border-bottom: 2px solid #333; 
                padding-bottom: 10px; 
                margin-bottom: 20px;
            }
            .print-row { 
                font-size: 18px; 
                margin: 15px 0; 
                display: flex;
                justify-content: space-between;
            }
            .signature-box {
                margin-top: 60px;
                text-align: right;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>

    <div class="card">
        <h2>文具申請單</h2>
        
        <div class="form-group">
            <label>申請人姓名</label>
            <input type="text" id="name" placeholder="請輸入姓名">
        </div>

        <div class="form-group">
            <label>所屬部門</label>
            <select id="dept">
                <option value="行政部">行政部</option>
                <option value="業務部">業務部</option>
                <option value="工程部">工程部</option>
                <option value="財務部">財務部</option>
            </select>
        </div>

        <div class="form-group">
            <label>欲申請文具</label>
            <input type="text" id="item" placeholder="例如：A4 影印紙">
        </div>

        <div class="form-group">
            <label>申請數量</label>
            <input type="number" id="amount" value="1" min="1">
        </div>

        <button onclick="submitForm()">送出並列印報表</button>
    </div>

    <div id="printArea">
        <div class="print-header">
            <h1>文具領用證明單</h1>
        </div>
        <div class="print-row"><span>申請日期：</span><span id="p-date"></span></div>
        <div class="print-row"><span>申請人：</span><span id="p-name"></span></div>
        <div class="print-row"><span>部門：</span><span id="p-dept"></span></div>
        <div class="print-row"><span>申請項目：</span><span id="p-item"></span></div>
        <div class="print-row"><span>數量：</span><span id="p-amount"></span></div>
        
        <div class="signature-box">
            <p>部門主管簽章：____________________</p>
            <p style="margin-top: 30px;">經手人簽章：____________________</p>
        </div>
        <p style="font-size: 12px; color: gray; text-align: center; margin-top: 50px;">此單據由系統自動產生</p>
    </div>

    <script>
        async function submitForm() {
            // --- 重點：請在此處貼上你的 Google Apps Script 部署網址 ---
            const scriptUrl = "你的_GOOGLE_SCRIPT_網址";
            
            const name = document.getElementById('name').value;
            const dept = document.getElementById('dept').value;
            const item = document.getElementById('item').value;
            const amount = document.getElementById('amount').value;

            // 簡單檢查是否有填寫
            if (!name || !item) {
                alert("請填寫姓名與文具名稱喔！");
                return;
            }

            const data = { name, dept, item, amount };

            // 顯示傳送中狀態
            const btn = document.querySelector('button');
            btn.innerText = "傳送中...";
            btn.disabled = true;

            try {
                // 使用 Google Apps Script 建議的傳送方式
                await fetch(scriptUrl, {
                    method: 'POST',
                    mode: 'no-cors', // 解決 CORS 跨網域問題
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                // 資料傳送後，準備列印
                alert('資料已成功記錄至試算表！');
                preparePrint(data);

            } catch (error) {
                console.error('Error:', error);
                alert('傳送失敗，請確認網路連線或 GAS 網址。');
            } finally {
                btn.innerText = "送出並列印報表";
                btn.disabled = false;
            }
        }

        function preparePrint(data) {
            // 將填寫的資料填入列印版面
            document.getElementById('p-date').innerText = new Date().toLocaleString();
            document.getElementById('p-name').innerText = data.name;
            document.getElementById('p-dept').innerText = data.dept;
            document.getElementById('p-item').innerText = data.item;
            document.getElementById('p-amount').innerText = data.amount;

            // 觸發列印
            window.print();
        }
    </script>
</body>
</html>
